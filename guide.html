<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JanitorAI Script Builder: User Manual</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ========================================
           GUIDE-SPECIFIC LAYOUT
           ======================================== */
        body {
            background-color: var(--bg-primary);
        }

        .guide-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* ========================================
           TYPOGRAPHY
           ======================================== */
        .guide-container h1 {
            font-family: var(--font-family-jura);
            font-size: 2rem;
            font-weight: var(--font-weight-bold);
            color: var(--white-100);
            margin: 0 0 1rem 0;
            padding-bottom: 0.75rem;
            border-bottom: 3px solid var(--colour-pink-500);
        }

        .guide-container h2 {
            font-family: var(--font-family-jura);
            font-size: 1.5rem;
            font-weight: var(--font-weight-semibold);
            color: var(--colour-pink-400);
            margin: 2.5rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--scripts-border-color);
        }

        .guide-container h3 {
            font-family: var(--font-family-jura);
            font-size: 1.25rem;
            font-weight: var(--font-weight-semibold);
            color: var(--colour-purple-400);
            margin: 1.5rem 0 0.75rem 0;
        }

        .guide-container p {
            font-family: var(--font-family-jura);
            font-size: var(--fontsize-body-sm);
            color: var(--white-80);
            line-height: 1.7;
            margin: 1rem 0;
        }

        .guide-container > p:first-of-type {
            font-size: var(--fontsize-body-md);
            color: var(--white-70);
        }

        /* ========================================
           LISTS
           ======================================== */
        .guide-container ul,
        .guide-container ol {
            font-family: var(--font-family-jura);
            font-size: var(--fontsize-body-sm);
            color: var(--white-80);
            line-height: 1.7;
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .guide-container li {
            margin: 0.5rem 0;
        }

        .guide-container li strong {
            color: var(--white-100);
        }

        .guide-container li em {
            color: var(--white-60);
            font-style: italic;
        }

        /* ========================================
           CODE
           ======================================== */
        .guide-container code {
            font-family: var(--font-family-jura);
            font-size: 0.9em;
            background: var(--colour-grey-700);
            color: var(--colour-pink-300);
            padding: 0.2em 0.5em;
            border-radius: 4px;
        }

        /* ========================================
           CALLOUT CARDS
           ======================================== */
        .guide-container .janitor-card {
            margin: 1rem 0;
            padding: 1rem;
            background: var(--colour-grey-700);
            border: 1px solid var(--scripts-border-color);
            border-radius: 8px;
        }

        .guide-container .janitor-card strong {
            font-family: var(--font-family-jura);
            color: var(--colour-pink-400);
            display: block;
            margin-bottom: 0.5rem;
        }

        .guide-container .janitor-card p {
            margin: 0;
        }

        /* Warning variant */
        .guide-container .janitor-card.warning {
            border-left: 3px solid var(--colour-pink-500);
        }

        /* ========================================
           WORKFLOW LIST
           ======================================== */
        .guide-container ol.workflow {
            counter-reset: workflow;
            list-style: none;
            padding-left: 0;
        }

        .guide-container ol.workflow li {
            counter-increment: workflow;
            position: relative;
            padding-left: 2.5rem;
            margin: 0.75rem 0;
        }

        .guide-container ol.workflow li::before {
            content: counter(workflow);
            position: absolute;
            left: 0;
            width: 1.75rem;
            height: 1.75rem;
            background: linear-gradient(135deg, var(--colour-pink-600), var(--colour-purple-600));
            color: var(--white-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-family-jura);
            font-size: var(--fontsize-body-ty);
            font-weight: var(--font-weight-bold);
        }

        /* ========================================
           PRINT STYLES
           ======================================== */
        @media print {
            /* Page setup */
            @page {
                size: letter;
                margin: 0.75in;
            }

            /* Reset to print-friendly colors */
            body {
                background: #fff !important;
                color: #000 !important;
                font-size: 11pt;
                line-height: 1.5;
            }

            .guide-container {
                max-width: 100%;
                padding: 0;
            }

            /* Typography adjustments */
            .guide-container h1 {
                color: #000 !important;
                font-size: 22pt;
                border-bottom-color: #333 !important;
                text-shadow: none !important;
            }

            .guide-container h2 {
                color: #000 !important;
                font-size: 16pt;
                border-bottom-color: #ccc !important;
                page-break-after: avoid;
            }

            .guide-container h3 {
                color: #333 !important;
                font-size: 13pt;
                page-break-after: avoid;
            }

            .guide-container p,
            .guide-container li {
                color: #000 !important;
            }

            .guide-container li strong {
                color: #000 !important;
            }

            .guide-container li em {
                color: #555 !important;
            }

            .guide-container > p:first-of-type {
                color: #333 !important;
            }

            /* Code blocks */
            .guide-container code {
                background: #f0f0f0 !important;
                color: #333 !important;
                border: 1px solid #ccc;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* Callout cards */
            .guide-container .janitor-card {
                background: #f9f9f9 !important;
                border: 1px solid #ccc !important;
                border-left: 3px solid #666 !important;
                page-break-inside: avoid;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .guide-container .janitor-card.warning {
                border-left-color: #333 !important;
            }

            .guide-container .janitor-card strong {
                color: #000 !important;
            }

            .guide-container .janitor-card p {
                color: #000 !important;
            }

            /* Workflow list */
            .guide-container ol.workflow li::before {
                background: #333 !important;
                color: #fff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* Page break controls */
            .guide-container h2 {
                page-break-before: auto;
            }

            .guide-container ul,
            .guide-container ol {
                page-break-inside: avoid;
            }

            /* Orphan/widow control */
            .guide-container p,
            .guide-container li {
                orphans: 3;
                widows: 3;
            }

            /* Keep headers with following content */
            .guide-container h2 + *,
            .guide-container h3 + * {
                page-break-before: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="guide-container">
        <h1>JanitorAI Script Builder: User Manual</h1>
        <p>This tool provides a visual interface for creating "Icehellionx Standard" scripts. It automatically handles variable scoping, regular expressions, and stateless logic generation.</p>

        <h2>1. Core Concepts</h2>

        <h3>Stateless Execution & Runtime Injection</h3>
        <p>JanitorAI scripts execute fresh on every message generation. They do not persist variables (like <code>var score = 10;</code>) between turns.</p>
        <div class="janitor-card">
            <strong>How "Memory" Works:</strong>
            <p>Scripts cannot permanently write to the character's database. Instead, they use <strong>Runtime Injection</strong>. The script scans the chat history every turn, finds relevant details (like a name), and injects them into the context specifically for the current reply.</p>
        </div>

        <h3>Interface Overview</h3>
        <ul>
            <li><strong>Sidebar Navigation:</strong> Displays available modules. Disabled modules appear dimmed; enabled modules appear bright. Clicking a disabled module will automatically enable it.</li>
            <li><strong>Module Control Panel:</strong> The master list of modules. The order here determines execution order in the final script.</li>
            <li><strong>Token Meter:</strong> Monitors script size. Recommended limit is ~10,000 characters.</li>
        </ul>

        <h2>2. Modules</h2>

        <h3>Lorebook</h3>
        <p>Triggers descriptions based on keywords.</p>
        <ul>
            <li><strong>Padded Matching:</strong> Adds invisible spaces to prevent partial matches (e.g., "cat" matching inside "catch"). Recommended ON for single words.</li>
            <li><strong>Break After First Match:</strong> Stops scanning after finding one entry to save tokens.</li>
        </ul>

        <h3>Memory System</h3>
        <p>Scans the user's last message for patterns.</p>
        <ul>
            <li><strong>Name Detection:</strong> Captures text following a trigger phrase (e.g., "my name is").</li>
            <li><strong>Fact Extraction:</strong> Captures sentences starting with specific keywords (e.g., "I love") and injects them into the context.</li>
        </ul>

        <h3>Pacing</h3>
        <p>Gates content based on message count.</p>
        <ul>
            <li><strong>Phases:</strong> Active for a specific range (e.g., 1-10).</li>
            <li><strong>One-Time Events:</strong> Triggers exactly once on a specific count.</li>
            <li><em>Note: Rerolling a response does not increment the count.</em></li>
        </ul>

        <h3>Tone & State</h3>
        <p>Temporarily overrides personality.</p>
        <ul>
            <li><strong>Function:</strong> Appends text to the personality field for the current turn only.</li>
        </ul>

        <h3>Time & Environment</h3>
        <p>Injects time-of-day descriptions.</p>
        <div class="janitor-card warning">
            <strong>Timezone Offset:</strong>
            <p>Server time is UTC. You must set an offset (e.g., -5 for EST) to match your local time.</p>
        </div>

        <h3>Ambient & Random Events</h3>
        <ul>
            <li><strong>Ambient:</strong> Flavor text based on probability %.</li>
            <li><strong>Random:</strong> Weighted reactions to specific user phrases.</li>
        </ul>

        <h3>Combined Conditions</h3>
        <p>Creates AND-logic rules. All filled fields (Keyword + Time + Count) must be true for the rule to fire.</p>

        <h2>3. Validation Tools</h2>

        <h3>Trigger Analyzer</h3>
        <p>Scans for conflicts (same keyword in multiple modules) and overlaps (substring matches).</p>

        <h3>Script Tester</h3>
        <p>Simulates the JanitorAI environment.</p>
        <div class="janitor-card">
            <strong>Workflow:</strong>
            <p>You must click <strong>"Generate All Enabled Modules"</strong> before running the tester. The tester runs against the generated output.</p>
        </div>

        <h2>4. Recommended Workflow</h2>
        <ol class="workflow">
            <li><strong>Configure:</strong> Enable modules and input data.</li>
            <li><strong>Analyze:</strong> Check for keyword conflicts.</li>
            <li><strong>Generate:</strong> Create the script.</li>
            <li><strong>Test:</strong> Verify triggers in the sandbox.</li>
            <li><strong>Deploy:</strong> Copy final output to JanitorAI.</li>
        </ol>
    </div>
</body>
</html>
