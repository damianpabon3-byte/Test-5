<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JanitorAI Script Builder: User Manual</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ========================================
           GUIDE-SPECIFIC LAYOUT
           ======================================== */
        body {
            background-color: var(--bg-primary);
        }

        .guide-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* ========================================
           MAIN TITLE WITH GLOW
           ======================================== */
        .guide-title {
            font-family: var(--font-family-jura);
            font-size: 2.25rem;
            font-weight: var(--font-weight-bold);
            color: var(--white-100);
            margin: 0 0 0.5rem 0;
            text-align: center;
            text-shadow:
                0 0 10px var(--colour-pink-500),
                0 0 20px var(--colour-pink-600),
                0 0 40px var(--colour-pink-700);
            letter-spacing: 1px;
        }

        .guide-subtitle {
            font-family: var(--font-family-jura);
            font-size: var(--fontsize-body-md);
            color: var(--white-60);
            text-align: center;
            margin: 0 0 2rem 0;
        }

        /* ========================================
           SECTION CARDS
           ======================================== */
        .guide-section {
            background: var(--scripts-bg-primary);
            border: 1px solid var(--scripts-border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .guide-section:hover {
            border-color: var(--colour-pink-700);
            box-shadow: 0 4px 12px rgba(247, 134, 244, 0.1);
        }

        /* ========================================
           TYPOGRAPHY
           ======================================== */
        .guide-section h2 {
            font-family: var(--font-family-jura);
            font-size: 1.5rem;
            font-weight: var(--font-weight-semibold);
            color: var(--colour-pink-400);
            margin: 0 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--colour-pink-500);
        }

        .guide-section h3 {
            font-family: var(--font-family-jura);
            font-size: 1.25rem;
            font-weight: var(--font-weight-semibold);
            color: var(--colour-purple-400);
            margin: 1.5rem 0 0.75rem 0;
        }

        .guide-section h3:first-of-type {
            margin-top: 0;
        }

        .guide-section p {
            font-family: var(--font-family-jura);
            font-size: var(--fontsize-body-sm);
            color: var(--white-80);
            line-height: 1.7;
            margin: 0.75rem 0;
        }

        /* ========================================
           LISTS
           ======================================== */
        .guide-section ul,
        .guide-section ol {
            font-family: var(--font-family-jura);
            font-size: var(--fontsize-body-sm);
            color: var(--white-80);
            line-height: 1.7;
            margin: 0.75rem 0;
            padding-left: 1.5rem;
        }

        .guide-section li {
            margin: 0.5rem 0;
        }

        .guide-section li strong {
            color: var(--white-100);
        }

        .guide-section li em {
            color: var(--white-60);
            font-style: italic;
        }

        /* ========================================
           CODE
           ======================================== */
        .guide-section code {
            font-family: 'Fira Code', var(--font-family-jura), monospace;
            font-size: 0.85em;
            background: var(--colour-grey-700);
            color: var(--colour-pink-300);
            padding: 0.2em 0.5em;
            border-radius: 4px;
            border: 1px solid var(--scripts-border-color);
        }

        /* ========================================
           CALLOUT CARDS (NESTED)
           ======================================== */
        .guide-section .janitor-card {
            margin: 1rem 0;
            padding: 1rem;
            background: var(--colour-grey-700);
            border: 1px solid var(--scripts-border-color);
            border-radius: 8px;
            border-left: 3px solid var(--colour-purple-500);
        }

        .guide-section .janitor-card strong {
            font-family: var(--font-family-jura);
            color: var(--colour-pink-400);
            display: block;
            margin-bottom: 0.5rem;
        }

        .guide-section .janitor-card p {
            margin: 0;
            color: var(--white-70);
        }

        /* Warning variant */
        .guide-section .janitor-card.warning {
            border-left-color: var(--colour-pink-500);
            background: linear-gradient(90deg, rgba(247, 134, 244, 0.08), var(--colour-grey-700));
        }

        /* ========================================
           WORKFLOW LIST
           ======================================== */
        .guide-section ol.workflow {
            counter-reset: workflow;
            list-style: none;
            padding-left: 0;
        }

        .guide-section ol.workflow li {
            counter-increment: workflow;
            position: relative;
            padding-left: 2.5rem;
            margin: 0.75rem 0;
        }

        .guide-section ol.workflow li::before {
            content: counter(workflow);
            position: absolute;
            left: 0;
            width: 1.75rem;
            height: 1.75rem;
            background: linear-gradient(135deg, var(--colour-pink-600), var(--colour-purple-600));
            color: var(--white-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-family-jura);
            font-size: var(--fontsize-body-ty);
            font-weight: var(--font-weight-bold);
            box-shadow: 0 0 8px rgba(247, 134, 244, 0.4);
        }

        /* ========================================
           PRINT STYLES
           ======================================== */
        @media print {
            /* Page setup */
            @page {
                size: letter;
                margin: 0.75in;
            }

            /* Reset to print-friendly colors */
            body {
                background: #fff !important;
                color: #000 !important;
                font-size: 11pt;
                line-height: 1.5;
            }

            .guide-container {
                max-width: 100%;
                padding: 0;
            }

            /* Remove glow and cyberpunk effects */
            .guide-title {
                color: #000 !important;
                font-size: 22pt;
                text-shadow: none !important;
            }

            .guide-subtitle {
                color: #333 !important;
            }

            /* Remove card styling for print */
            .guide-section {
                background: transparent !important;
                border: none !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                padding: 0 !important;
                margin-bottom: 1.5rem !important;
                page-break-inside: avoid;
            }

            .guide-section:hover {
                border-color: transparent !important;
                box-shadow: none !important;
            }

            /* Typography adjustments */
            .guide-section h2 {
                color: #000 !important;
                font-size: 16pt;
                border-bottom: 2px solid #333 !important;
                page-break-after: avoid;
            }

            .guide-section h3 {
                color: #333 !important;
                font-size: 13pt;
                page-break-after: avoid;
            }

            .guide-section p,
            .guide-section li {
                color: #000 !important;
            }

            .guide-section li strong {
                color: #000 !important;
            }

            .guide-section li em {
                color: #555 !important;
            }

            /* Code blocks */
            .guide-section code {
                background: #f0f0f0 !important;
                color: #333 !important;
                border: 1px solid #ccc !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* Callout cards - flatten for print */
            .guide-section .janitor-card {
                background: #f9f9f9 !important;
                border: 1px solid #ccc !important;
                border-left: 3px solid #666 !important;
                page-break-inside: avoid;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .guide-section .janitor-card.warning {
                border-left-color: #333 !important;
            }

            .guide-section .janitor-card strong {
                color: #000 !important;
            }

            .guide-section .janitor-card p {
                color: #000 !important;
            }

            /* Workflow list */
            .guide-section ol.workflow li::before {
                background: #333 !important;
                color: #fff !important;
                box-shadow: none !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* Page break controls */
            .guide-section h2 {
                page-break-before: auto;
            }

            .guide-section ul,
            .guide-section ol {
                page-break-inside: avoid;
            }

            /* Orphan/widow control */
            .guide-section p,
            .guide-section li {
                orphans: 3;
                widows: 3;
            }

            /* Keep headers with following content */
            .guide-section h2 + *,
            .guide-section h3 + * {
                page-break-before: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="guide-container">
        <!-- Header -->
        <h1 class="guide-title">JanitorAI Script Builder</h1>
        <p class="guide-subtitle">User Manual</p>

        <!-- Introduction Section -->
        <div class="guide-section">
            <h2>Introduction</h2>
            <p>This tool provides a visual interface for creating "Icehellionx Standard" scripts. It automatically handles variable scoping, regular expressions, and stateless logic generation.</p>
        </div>

        <!-- Core Concepts Section -->
        <div class="guide-section">
            <h2>1. Core Concepts</h2>

            <h3>Stateless Execution & Runtime Injection</h3>
            <p>JanitorAI scripts execute fresh on every message generation. They do not persist variables (like <code>var score = 10;</code>) between turns.</p>
            <div class="janitor-card">
                <strong>How "Memory" Works:</strong>
                <p>Scripts cannot permanently write to the character's database. Instead, they use <strong>Runtime Injection</strong>. The script scans the chat history every turn, finds relevant details (like a name), and injects them into the context specifically for the current reply.</p>
            </div>

            <h3>Interface Overview</h3>
            <ul>
                <li><strong>Sidebar Navigation:</strong> Displays available modules. Disabled modules appear dimmed; enabled modules appear bright. Clicking a disabled module will automatically enable it.</li>
                <li><strong>Module Control Panel:</strong> The master list of modules. The order here determines execution order in the final script.</li>
                <li><strong>Token Meter:</strong> Monitors script size. Recommended limit is ~10,000 characters.</li>
            </ul>
        </div>

        <!-- Modules Section -->
        <div class="guide-section">
            <h2>2. Modules</h2>

            <h3>Lorebook</h3>
            <p>Triggers descriptions based on keywords.</p>
            <ul>
                <li><strong>Padded Matching:</strong> Adds invisible spaces to prevent partial matches (e.g., "cat" matching inside "catch"). Recommended ON for single words.</li>
                <li><strong>Break After First Match:</strong> Stops scanning after finding one entry to save tokens.</li>
            </ul>

            <h3>Memory System</h3>
            <p>Scans the user's last message for patterns.</p>
            <ul>
                <li><strong>Name Detection:</strong> Captures text following a trigger phrase (e.g., "my name is").</li>
                <li><strong>Fact Extraction:</strong> Captures sentences starting with specific keywords (e.g., "I love") and injects them into the context.</li>
            </ul>

            <h3>Pacing</h3>
            <p>Gates content based on message count.</p>
            <ul>
                <li><strong>Phases:</strong> Active for a specific range (e.g., 1-10).</li>
                <li><strong>One-Time Events:</strong> Triggers exactly once on a specific count.</li>
                <li><em>Note: Rerolling a response does not increment the count.</em></li>
            </ul>

            <h3>Tone & State</h3>
            <p>Temporarily overrides personality.</p>
            <ul>
                <li><strong>Function:</strong> Appends text to the personality field for the current turn only.</li>
            </ul>

            <h3>Time & Environment</h3>
            <p>Injects time-of-day descriptions.</p>
            <div class="janitor-card warning">
                <strong>Timezone Offset:</strong>
                <p>Server time is UTC. You must set an offset (e.g., -5 for EST) to match your local time.</p>
            </div>

            <h3>Ambient & Random Events</h3>
            <ul>
                <li><strong>Ambient:</strong> Flavor text based on probability %.</li>
                <li><strong>Random:</strong> Weighted reactions to specific user phrases.</li>
            </ul>

            <h3>Combined Conditions</h3>
            <p>Creates AND-logic rules. All filled fields (Keyword + Time + Count) must be true for the rule to fire.</p>
        </div>

        <!-- Validation Tools Section -->
        <div class="guide-section">
            <h2>3. Validation Tools</h2>

            <h3>Trigger Analyzer</h3>
            <p>Scans for conflicts (same keyword in multiple modules) and overlaps (substring matches).</p>

            <h3>Script Tester</h3>
            <p>Simulates the JanitorAI environment.</p>
            <div class="janitor-card">
                <strong>Workflow:</strong>
                <p>You must click <strong>"Generate All Enabled Modules"</strong> before running the tester. The tester runs against the generated output.</p>
            </div>
        </div>

        <!-- Workflow Section -->
        <div class="guide-section">
            <h2>4. Recommended Workflow</h2>
            <ol class="workflow">
                <li><strong>Configure:</strong> Enable modules and input data.</li>
                <li><strong>Analyze:</strong> Check for keyword conflicts.</li>
                <li><strong>Generate:</strong> Create the script.</li>
                <li><strong>Test:</strong> Verify triggers in the sandbox.</li>
                <li><strong>Deploy:</strong> Copy final output to JanitorAI.</li>
            </ol>
        </div>
    </div>
</body>
</html>
