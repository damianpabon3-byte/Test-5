<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Janitor Script Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Jura:wght@300..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- Mobile Header (visible only on mobile) -->
<header class="mobile-header">
  <div class="mobile-header-left">
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle navigation menu" aria-expanded="false">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    <img class="mobile-header-logo" src="logo2x-1_ia066y.png" alt="Janitor AI">
  </div>
  <span class="mobile-header-title">Script Builder</span>
</header>

<!-- Sidebar Backdrop (dims background when sidebar is open) -->
<div class="sidebar-backdrop" id="sidebarBackdrop"></div>

<div class="app-container">
    
    <aside class="sidebar" id="appSidebar">
      <div class="logo-area">
        <img src="logo2x-1_ia066y.png" alt="Logo" class="logo-img">
        <p class="logo-text">Script Builder v0.2.6</p>
      </div>

      <nav class="nav-links">
        <button class="nav-btn active" onclick="switchTab(event, 'lorebook')">ğŸ“– Lorebook</button>
        <button class="nav-btn" onclick="switchTab(event, 'memory')">ğŸ§  Memory</button>
        <button class="nav-btn" onclick="switchTab(event, 'pacing')">ğŸ“Š Pacing</button>
        <button class="nav-btn" onclick="switchTab(event, 'tone')">ğŸ­ Tone/State</button>
        <button class="nav-btn" onclick="switchTab(event, 'time')">ğŸŒ… Time & Env</button>
        <button class="nav-btn" onclick="switchTab(event, 'ambient')">ğŸŒ¿ Ambient</button>
        <button class="nav-btn" onclick="switchTab(event, 'random')">ğŸ² Random</button>
        <button class="nav-btn" onclick="switchTab(event, 'combined')">ğŸ”— Combined</button>
        <button class="nav-btn" onclick="switchTab(event, 'scoring')">ğŸ¯ Scoring</button>
        <button class="nav-btn" onclick="switchTab(event, 'tester')">ğŸ§ª Tester</button>
      </nav>
    </aside>

    <main class="main-content">
      
      <header class="content-header">
        <button class="mobile-menu-btn" id="menuBtn">â˜°</button>
        <h3>Janitor Script Builder</h3>
      </header>

      <div class="scrollable-area">
        <div class="max-width-wrapper">
          
          <div class="onboarding-card">
            <h2>ğŸ“ Stateless 101: Understanding How Scripts Work</h2>
            <p style="margin-bottom: 12px;">
              <strong>Key Concept:</strong> JanitorAI scripts run fresh on <em>every single message</em>. Variables don't persist between messages unless you store them in scenario/personality notes.
            </p>
            <div class="onboarding-examples">
              <div class="onboarding-example">
                <strong>âŒ Won't Work:</strong>
                <code>var score = 0; score++;</code>
                <small style="display:block; margin-top:4px;">Score resets to 0 every message</small>
              </div>
              <div class="onboarding-example">
                <strong>âœ… Will Work:</strong>
                <code>Memory â†’ adds to scenario notes</code>
                <small style="display:block; margin-top:4px;">Scenario persists between messages</small>
              </div>
              <div class="onboarding-example">
                <strong>âš ï¸ Experimental:</strong>
                <code>Using {{char}} tags for variables</code>
                <small style="display:block; margin-top:4px;">Fragile, can break with updates</small>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>âœ… Pre-Launch Test Checklist</h3>
            <div class="checklist">
              <h4>Before using your script in JanitorAI:</h4>
              <ul>
                <li>âœ“ Enable <strong>Debug Mode</strong> in Module Control Panel for first test</li>
                <li>âœ“ Start with 1-2 modules, add more once working</li>
                <li>âœ“ Test each trigger keyword/phrase in a real conversation</li>
                <li>âœ“ Check scenario notes after 5-10 messages for bloat</li>
                <li>âœ“ Verify message_count increments correctly (rerolls don't count)</li>
                <li>âœ“ Disable debug mode before final deployment</li>
                <li>âœ“ Keep total script under 10,000 characters for best performance</li>
              </ul>
            </div>
            <div class="info-banner" style="margin-top: 12px;">
              <strong>ğŸ’¡ Reroll Behavior:</strong> When you reroll a character response, <code>message_count</code> does NOT increment. Only new user messages increase the count.
            </div>
          </div>

          <div class="card">
            <h3>ğŸ“‹ Recommended Build Order (Pro Workflow)</h3>
            <p>Follow this order for the most reliable and maintainable scripts:</p>
            <ol style="line-height: 1.8;">
              <li><strong>Lorebook</strong> â†’ Foundation for rich context (most stable)</li>
              <li><strong>Memory System</strong> â†’ Track user info (stable)</li>
              <li><strong>Pacing</strong> â†’ Gate story progression (stable)</li>
              <li><strong>Tone/State Engine</strong> â†’ Dynamic mood shifts (stable)</li>
              <li><strong>Time & Environment</strong> â†’ Hour-based behaviors (stable)</li>
              <li><strong>Ambient Events</strong> â†’ Add flavor (watch token growth)</li>
              <li><strong>Random Events</strong> â†’ Weighted reactions (moderate complexity)</li>
              <li><strong>Combined Conditions</strong> â†’ Multi-trigger rules (advanced)</li>
              <li><strong>Scoring (Stateless only)</strong> â†’ Sentiment analysis (experimental)</li>
            </ol>
          </div>

          <div class="card">
            <h3>ğŸ§¹ Scenario Maintenance Best Practices</h3>
            <div class="warning-banner">
              <strong>âš ï¸ Token Bloat Warning:</strong> Scripts that only append to scenario will cause slowdowns over long conversations.
            </div>
            <p><strong>Pro strategies to prevent bloat:</strong></p>
            <ul style="line-height: 1.6;">
              <li><strong>Use personality for moods/states</strong> instead of scenario (personality can be overwritten)</li>
              <li><strong>Summarize old notes periodically</strong> instead of endless appending</li>
              <li><strong>Use lorebooks for static info</strong> that only triggers when relevant</li>
              <li><strong>Prefer "replace" over "append"</strong> for things that change (time, mood)</li>
              <li><strong>Test scenario length</strong> after 20-30 messages and clean if needed</li>
            </ul>
          </div>

          <div class="card">
            <h3>âš™ï¸ Module Control Panel</h3>
            <div class="debug-toggle">
              <input type="checkbox" id="debugMode" class="janitor-switch" />
              <label for="debugMode">
                <strong>ğŸ› Debug Mode:</strong> Add "(debug: module fired)" notes to scenario output for testing
              </label>
            </div>
            <div class="warning-banner">
              <strong>âš ï¸ Execution Order Matters!</strong> Modules run in the order below. Later modules can override earlier ones. Drag to reorder.
            </div>
            <div id="moduleOrder" class="module-order">
              <div class="order-item" draggable="true" data-module="lorebook">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-lorebook" class="janitor-switch" checked />
                <label for="toggle-lorebook">Lorebook</label>
              </div>
              <div class="order-item" draggable="true" data-module="memory">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-memory" class="janitor-switch" checked />
                <label for="toggle-memory">Memory System</label>
              </div>
              <div class="order-item" draggable="true" data-module="pacing">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-pacing" class="janitor-switch" checked />
                <label for="toggle-pacing">Pacing</label>
              </div>
              <div class="order-item" draggable="true" data-module="tone">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-tone" class="janitor-switch" checked />
                <label for="toggle-tone">Tone/State Engine</label>
              </div>
              <div class="order-item" draggable="true" data-module="time">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-time" class="janitor-switch" />
                <label for="toggle-time">Time & Environment</label>
              </div>
              <div class="order-item" draggable="true" data-module="ambient">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-ambient" class="janitor-switch" />
                <label for="toggle-ambient">Ambient Events</label>
              </div>
              <div class="order-item" draggable="true" data-module="random">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-random" class="janitor-switch" />
                <label for="toggle-random">Random Events</label>
              </div>
              <div class="order-item" draggable="true" data-module="combined">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-combined" class="janitor-switch" />
                <label for="toggle-combined">Combined Conditions</label>
              </div>
              <div class="order-item" draggable="true" data-module="scoring">
                <span class="drag-handle">â‹®â‹®</span>
                <input type="checkbox" id="toggle-scoring" class="janitor-switch" />
                <label for="toggle-scoring">Scoring Engine (Experimental)</label>
              </div>
            </div>
            <button type="button" class="btn btn-success" onclick="generateFinalCombinedScript()">
              ğŸ“¦ Copy All Enabled Modules
            </button>
            <button type="button" class="btn btn-warning" onclick="generateAllEnabledModules()">
              âš¡ Generate All Enabled (then combine)
            </button>
            <button type="button" class="btn btn-danger" onclick="resetAllFields()">
              ğŸ”„ Reset All Fields
            </button>
            <div class="token-meter" id="tokenMeter">
              <span>Estimated Script Size: <strong id="tokenCount">0</strong> characters</span>
              <div class="bar">
                <div class="fill" id="tokenFill" style="width: 0%"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>ğŸ“š Load Preset Templates</h3>
            <p>Click a preset to auto-fill the form with starter values.</p>
            <div class="preset-grid">
              <div class="preset-card" onclick="loadPreset('slowburn')">
                <h4>ğŸŒ¹ Slow-Burn Romance</h4>
                <p>Gradual relationship progression</p>
              </div>
              <div class="preset-card" onclick="loadPreset('rpg')">
                <h4>âš”ï¸ RPG Adventure</h4>
                <p>Lorebook-heavy with locations & NPCs</p>
              </div>
              <div class="preset-card" onclick="loadPreset('ambient')">
                <h4>ğŸŒ¿ Ambient Flavor Pack</h4>
                <p>Random environmental details</p>
              </div>
              <div class="preset-card" onclick="loadPreset('memory')">
                <h4>ğŸ§  Memory Starter</h4>
                <p>Name + facts tracking</p>
              </div>
            </div>
          </div>

          <div id="lorebook" class="tab-panel active">
            <h3>ğŸ“– Lorebook (Hierarchical Keyword Database)</h3>
            <p>Create a rich world with people, places, objects, moods, and events that trigger based on keywords.</p>
            
            <div class="warning-banner">
              <strong>âš ï¸ Token Warning:</strong> Keep entries 2-4 short paragraphs each.
            </div>

            <div class="switch-group">
                <input type="checkbox" id="lorePadded" class="janitor-switch" checked />
                <label for="lorePadded">Use Padded Matching</label>
            </div>
            <div class="help-text">Prevents partial word matches (e.g., "cat" won't trigger on "catch").</div>

            <div class="switch-group">
                <input type="checkbox" id="loreBreakEarly" class="janitor-switch" checked />
                <label for="loreBreakEarly">Break After First Match</label>
            </div>
            <div class="help-text">Stop after the first lore entry triggers (saves tokens).</div>

            <h4>ğŸ“ Lore Entries</h4>
            <button type="button" class="btn btn-secondary" onclick="addLoreEntry()">+ Add Entry</button>
            <div id="loreEntries" class="dynamic-list"></div>

            <button type="button" class="btn" onclick="generateLorebookScript()">Generate Lorebook Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('lorebookOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="lorebookOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="memory" class="tab-panel">
            <h3>ğŸ§  Memory System</h3>
            <p>Automatically detect and remember the user's name, facts about them, likes, and dislikes.</p>
            
            <div class="form-group">
              <label>Name Detection Trigger Phrase</label>
              <input type="text" id="memNamePhrase" class="janitor-input" placeholder="my name is" />
            </div>

            <div class="form-group">
              <label>Facts Keywords (comma-separated)</label>
              <input type="text" id="memFactsKeywords" class="janitor-input" placeholder="fact, i am, i work as, i study" />
            </div>

            <div class="form-group">
              <label>Likes Keywords (comma-separated)</label>
              <input type="text" id="memLikesKeywords" class="janitor-input" placeholder="i like, i love, i enjoy, favorite" />
            </div>

            <div class="form-group">
              <label>Dislikes Keywords (comma-separated)</label>
              <input type="text" id="memDislikesKeywords" class="janitor-input" placeholder="i hate, i dislike, i don't like, can't stand" />
            </div>

            <button type="button" class="btn" onclick="generateMemoryScript()">Generate Memory Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('memoryOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="memoryOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="pacing" class="tab-panel">
            <h3>ğŸ“Š Pacing System (Message Count Gates)</h3>
            <p>Control story progression based on how many messages have been sent.</p>

            <div class="warning-banner">
              <strong>âš ï¸ Reroll Behavior:</strong> Rerolls do NOT increment <code>message_count</code>.
            </div>

            <h4>ğŸ“ˆ Message Count Phases</h4>
            <button type="button" class="btn btn-secondary" onclick="addPacingPhase()">+ Add Phase</button>
            <div id="pacingPhases" class="dynamic-list"></div>

            <h4>ğŸ¯ One-Time Events (Exact Message Count)</h4>
            <button type="button" class="btn btn-secondary" onclick="addOneTimeEvent()">+ Add Event</button>
            <div id="oneTimeEvents" class="dynamic-list"></div>

            <button type="button" class="btn" onclick="generatePacingScript()">Generate Pacing Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('pacingOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="pacingOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="tone" class="tab-panel">
            <h3>ğŸ­ Tone/State Engine</h3>
            <p>Dynamically shift character personality based on keywords in user messages.</p>

            <div class="switch-group">
                <input type="checkbox" id="tonePadded" class="janitor-switch" checked />
                <label for="tonePadded">Use Padded Matching</label>
            </div>

            <h4>ğŸ¨ Tone Triggers</h4>
            <button type="button" class="btn btn-secondary" onclick="addToneTrigger()">+ Add Trigger</button>
            <div id="toneTriggers" class="dynamic-list"></div>

            <button type="button" class="btn" onclick="generateToneScript()">Generate Tone Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('toneOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="toneOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="time" class="tab-panel">
            <h3>ğŸŒ… Time & Environment System</h3>
            <p>Change character behavior and environment based on time of day.</p>

            <div class="form-group">
              <label>Timezone Offset (hours from UTC)</label>
              <input type="number" id="timeOffset" class="janitor-input" value="0" min="-12" max="14" />
              <div class="help-text">e.g., PST = -8, EST = -5, GMT = 0, JST = +9</div>
            </div>

            <h4>â° Time-Based Behaviors</h4>
            <button type="button" class="btn btn-secondary" onclick="addTimeSlot()">+ Add Time Slot</button>
            <div id="timeSlots" class="dynamic-list"></div>

            <button type="button" class="btn" onclick="generateTimeScript()">Generate Time Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('timeOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="timeOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="ambient" class="tab-panel">
            <h3>ğŸŒ¿ Ambient Events (Random Flavor Text)</h3>
            <p>Add random environmental details to make the world feel alive.</p>

            <div class="form-group">
              <label>Trigger Probability (%)</label>
              <input type="number" id="ambientProbability" class="janitor-input" value="10" min="1" max="100" />
            </div>

            <h4>ğŸ² Ambient Event Pool</h4>
            <button type="button" class="btn btn-secondary" onclick="addAmbientEvent()">+ Add Event</button>
            <div id="ambientEvents" class="dynamic-list"></div>

            <button type="button" class="btn" onclick="generateAmbientScript()">Generate Ambient Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('ambientOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="ambientOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="random" class="tab-panel">
            <h3>ğŸ² Random Events (Weighted Reactions)</h3>
            <p>Trigger random character reactions when user says specific phrases.</p>

            <h4>ğŸ¯ Event Triggers</h4>
            <button type="button" class="btn btn-secondary" onclick="addRandomEvent()">+ Add Event</button>
            <div id="randomEvents" class="dynamic-list"></div>

            <button type="button" class="btn" onclick="generateRandomScript()">Generate Random Events Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('randomOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="randomOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="combined" class="tab-panel">
            <h3>ğŸ”— Combined Conditions (Multi-Trigger Rules)</h3>
            <p>Create rules that fire when multiple conditions are met (keywords + time + message count).</p>

            <h4>âš¡ Combined Rules</h4>
            <button type="button" class="btn btn-secondary" onclick="addCombinedRule()">+ Add Rule</button>
            <div id="combinedRules" class="dynamic-list"></div>

            <button type="button" class="btn" onclick="generateCombinedConditionsScript()">Generate Combined Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('combinedOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="combinedOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="scoring" class="tab-panel">
            <h3>ğŸ¯ Scoring Engine (EXPERIMENTAL)</h3>
            
            <div class="danger-banner">
              <strong>âš ï¸ EXPERIMENTAL:</strong> Scoring is complex. Stateless mode is recommended.
            </div>

            <div class="form-group">
              <label>Scoring Mode</label>
              <select id="scoringMode" class="janitor-select">
                <option value="stateless">Stateless (Single-Turn Sentiment) - RECOMMENDED</option>
                <option value="persistent">Persistent (Experimental Tag-Based) - FRAGILE</option>
              </select>
            </div>

            <h4>â• Positive Keywords</h4>
            <div class="form-group">
              <input type="text" id="scoringPositive" class="janitor-input" placeholder="love, great, wonderful, amazing" />
            </div>

            <h4>â– Negative Keywords</h4>
            <div class="form-group">
              <input type="text" id="scoringNegative" class="janitor-input" placeholder="hate, awful, terrible, horrible" />
            </div>

            <h4>ğŸ“Š Score Thresholds & Responses</h4>
            <button type="button" class="btn btn-secondary" onclick="addScoreThreshold()">+ Add Threshold</button>
            <div id="scoreThresholds" class="dynamic-list"></div>

            <button type="button" class="btn" onclick="generateScoringScript()">Generate Scoring Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('scoringOutput')">Copy to Clipboard</button>
            
            <div class="output-box" id="scoringOutput">// Script will appear here after clicking Generate</div>
          </div>

          <div id="tester" class="tab-panel">
            <h3>ğŸ§ª Script Tester</h3>
            <p>Test your generated script with sample messages.</p>

            <div class="form-group">
              <label>Script Source</label>
              <select id="testerScriptSource" class="janitor-select" onchange="updateTesterScript()">
                <option value="final">Final Combined Output</option>
                <option value="lorebook">Lorebook Script</option>
                <option value="memory">Memory Script</option>
                <option value="pacing">Pacing Script</option>
                <option value="tone">Tone/State Script</option>
                <option value="time">Time & Environment Script</option>
                <option value="ambient">Ambient Events Script</option>
                <option value="random">Random Events Script</option>
                <option value="combined">Combined Conditions Script</option>
                <option value="scoring">Scoring Script</option>
                <option value="custom">Custom Script</option>
              </select>
            </div>

            <div id="testerCustomSection" style="display: none;">
              <div class="form-group">
                <label>Custom Script</label>
                <textarea id="testerCustomScript" class="janitor-textarea" rows="10" placeholder="Paste your script here..."></textarea>
              </div>
            </div>

            <div class="switch-group">
                <input type="checkbox" id="testerBatchMode" class="janitor-switch" onchange="toggleBatchMode()" />
                <label for="testerBatchMode">Enable Batch Testing</label>
            </div>

            <div id="testerSingleMode">
              <div class="form-group">
                <label>Test Message</label>
                <textarea id="testerMessage" class="janitor-textarea" rows="3" placeholder="I walk into the tavern..."></textarea>
              </div>
            </div>

            <div id="testerBatchSection" style="display: none;">
              <div class="form-group">
                <label>Test Messages</label>
                <button type="button" class="btn btn-secondary" onclick="addBatchTestMessage()" style="margin-left: 8px;">+ Add Message</button>
                <button type="button" class="btn btn-secondary" onclick="clearBatchMessages()" style="margin-left: 4px;">Clear All</button>
                <div id="batchTestMessages" class="dynamic-list" style="margin-top: 8px;"></div>
              </div>
            </div>

            <div class="form-group">
              <label>Character Name (optional)</label>
              <input type="text" id="testerCharName" class="janitor-input" placeholder="e.g., Luna" />
            </div>

            <div id="singleTestButtons">
              <button type="button" class="btn" onclick="runScriptTest()">â–¶ï¸ Run Test</button>
              <button type="button" class="btn btn-secondary" onclick="clearTestResults()">Clear Results</button>
            </div>

            <div id="batchTestButtons" style="display: none;">
              <button type="button" class="btn btn-success" onclick="runBatchTests()">ğŸš€ Run All Tests</button>
              <button type="button" class="btn btn-secondary" onclick="clearBatchResults()">Clear Results</button>
            </div>

            <div id="testerResults" class="tester-results" style="display: none;">
              <h4>ğŸ“Š Test Results</h4>

              <div class="tester-result-section">
                <strong>Console Output:</strong>
                <div class="output-box" id="testerConsoleOutput" style="max-height: 150px;">// Logs appear here</div>
              </div>

              <div class="tester-result-section">
                <strong>Personality Changes:</strong>
                <div class="output-box" id="testerPersonality" style="max-height: 100px;">(none)</div>
              </div>

              <div class="tester-result-section">
                <strong>Scenario Changes:</strong>
                <div class="output-box" id="testerScenario" style="max-height: 100px;">(none)</div>
              </div>

              <div class="tester-result-section">
                <strong>Example Dialogues Changes:</strong>
                <div class="output-box" id="testerExamples" style="max-height: 100px;">(none)</div>
              </div>
            </div>

            <div id="batchResults" style="display: none;">
              <h4>ğŸ“Š Batch Test Results</h4>
              <div id="batchResultsSummary" class="info-banner" style="margin-bottom: 12px;"></div>
              <div id="batchResultsList"></div>
            </div>
          </div>

          <div class="card">
            <h3>ğŸ” Trigger Analyzer</h3>
            <p>Scan all modules for potential keyword conflicts, overlaps, and bottlenecks.</p>
            <button type="button" class="btn" onclick="analyzeTriggers()">Analyze Triggers</button>
            <div id="analyzerResults"></div>
          </div>

          <div class="card">
            <h3>ğŸ“¦ Final Combined Output</h3>
            <p>This is the complete script with all enabled modules merged in your chosen order.</p>
            <button type="button" class="btn btn-success" onclick="generateFinalCombinedScript()">ğŸ”„ Regenerate Combined Script</button>
            <button type="button" class="btn btn-secondary" onclick="copyToClipboard('finalOutput')">Copy to Clipboard</button>
            <div class="output-box" id="finalOutput">// Combined script will appear here after clicking "Copy All Enabled Modules"</div>
          </div>

          </div>
      </div>
    </main>
  </div>

<script>
// ============================================
// MOBILE SIDEBAR TOGGLE
// ============================================
const hamburgerBtn = document.getElementById('hamburgerBtn');
const sidebar = document.getElementById('appSidebar');
const sidebarBackdrop = document.getElementById('sidebarBackdrop');

function openSidebar() {
  sidebar.classList.add('mobile-open');
  sidebarBackdrop.classList.add('visible');
  hamburgerBtn.classList.add('open');
  hamburgerBtn.setAttribute('aria-expanded', 'true');
  document.body.style.overflow = 'hidden'; // Prevent background scroll
}

function closeSidebar() {
  sidebar.classList.remove('mobile-open');
  sidebarBackdrop.classList.remove('visible');
  hamburgerBtn.classList.remove('open');
  hamburgerBtn.setAttribute('aria-expanded', 'false');
  document.body.style.overflow = ''; // Restore scroll
}

function toggleSidebar() {
  if (sidebar.classList.contains('mobile-open')) {
    closeSidebar();
  } else {
    openSidebar();
  }
}

// Event listeners for mobile sidebar
hamburgerBtn.addEventListener('click', toggleSidebar);
sidebarBackdrop.addEventListener('click', closeSidebar);

// Close sidebar on escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && sidebar.classList.contains('mobile-open')) {
    closeSidebar();
  }
});

// Close sidebar when clicking a nav button (mobile only)
document.querySelectorAll('.nav-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    if (window.innerWidth <= 768) {
      closeSidebar();
    }
  });
});

// Close sidebar when window is resized to desktop size
window.addEventListener('resize', () => {
  if (window.innerWidth > 768 && sidebar.classList.contains('mobile-open')) {
    closeSidebar();
  }
});
</script>

  <script type="module" src="js/app.js"></script>
</body>
</html>
